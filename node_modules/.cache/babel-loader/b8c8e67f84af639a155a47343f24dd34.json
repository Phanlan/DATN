{"ast":null,"code":"import _toConsumableArray from \"D:/eway/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _slicedToArray from \"D:/eway/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\n\nvar _jsxFileName = \"D:\\\\eway\\\\src\\\\pages\\\\NewPurchasingOrders.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useState, useContext, useEffect } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useHistory } from \"react-router-dom\";\nimport { Button } from \"primereact/button\";\nimport { ProgressBar } from \"primereact/progressbar\";\nimport { useForm } from \"react-hook-form\";\nimport { yupResolver } from \"@hookform/resolvers/yup\";\nimport * as yup from \"yup\";\nimport { PurchasingCreateOrderHeaderForm } from \"../components/PurchasingCreateOrderHeaderForm\";\nimport { PurchasingCreateOrderProductList } from \"../components/PurchasingCreateOrderProductList\";\nimport { POSSearchProductForm } from \"../components/POSSearchProductForm\";\nimport { PurchasingService } from \"../service/PurchasingService\";\nimport { ToastContext } from \"../App\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport var NewPurchasingOrders = function NewPurchasingOrders() {\n  _s();\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      orderItems = _useState2[0],\n      setOrderItems = _useState2[1];\n\n  var _useState3 = useState(0),\n      _useState4 = _slicedToArray(_useState3, 2),\n      grandTotal = _useState4[0],\n      setGrandTotal = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isTableEditing = _useState6[0],\n      setIsTableEditing = _useState6[1];\n\n  var _useState7 = useState(null),\n      _useState8 = _slicedToArray(_useState7, 2),\n      supplierSelected = _useState8[0],\n      setSupplierSelected = _useState8[1];\n\n  var _useTranslation = useTranslation(),\n      _useTranslation2 = _slicedToArray(_useTranslation, 1),\n      t = _useTranslation2[0];\n\n  var toast = useContext(ToastContext);\n  var history = useHistory();\n  var purchasingService = new PurchasingService();\n  useEffect(function () {\n    document.title = t(\"common:title.createNewPurchasingOrderList\");\n    return function () {\n      document.title = t('title.homepage');\n    };\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  var schema = yup.object().shape({\n    supplier: yup.string().required(t(\"common:valid.validFieldRequire\")),\n    originFacility: yup.string().required(t(\"common:valid.validFieldRequire\")),\n    priority: yup.number().required(t(\"common:valid.validFieldRequire\")).positive().integer().min(1).max(9),\n    shipAfterDate: yup.date().required(t(\"common:valid.validFieldRequire\")).min(new Date(new Date() - 5 * 60 * 1000), t(\"common:valid.validRequiredValueGreatherOrEqualDateTimeToDay\")).nullable().when(\"shipBeforeDate\", function (shipBeforeDate, schema) {\n      return shipBeforeDate ? schema.max(shipBeforeDate, t(\"common:valid.validStartDateMustLessThanOrEqualFinishDate\")) : schema;\n    }),\n    shipBeforeDate: yup.date().required(t(\"common:valid.validFieldRequire\")).min(yup.ref(\"shipAfterDate\") || new Date(), yup.ref(\"shipAfterDate\") ? t(\"common:valid.validFinishDateMustLargerThanStartDate\") : t(\"common:valid.validRequiredValueGreatherOrEqualDateTimeToDay\")).nullable(),\n    orderName: yup.string().notRequired()\n  });\n  var defaultValues = {\n    supplier: \"\",\n    originFacility: \"\",\n    priority: 5,\n    shipAfterDate: null,\n    shipBeforeDate: null,\n    orderName: \"\",\n    customerOrg: \"ORG_ZIZI_CORP\"\n  };\n\n  var _useForm = useForm({\n    defaultValues: defaultValues,\n    resolver: yupResolver(schema)\n  }),\n      control = _useForm.control,\n      _useForm$formState = _useForm.formState,\n      errors = _useForm$formState.errors,\n      isSubmitting = _useForm$formState.isSubmitting,\n      handleSubmit = _useForm.handleSubmit;\n\n  var onSubmit = function onSubmit(data) {\n    if (orderItems.length <= 0) {\n      toast.current.show({\n        severity: \"error\",\n        summary: t(\"common:errorMessage\"),\n        detail: t(\"common:order.listProductMustNotEmpty\"),\n        life: 5000\n      });\n      return;\n    }\n\n    var formData = {};\n    formData.vendorPartyId = data.supplier;\n    formData.customerPartyId = data.customerOrg;\n    formData.facilityId = data.originFacility;\n    formData.shipAfterDate = data.shipAfterDate.getTime();\n    formData.shipBeforeDate = data.shipBeforeDate.getTime();\n    formData.orderName = data.orderName === \"\" ? null : data.orderName;\n    formData.priority = data.priority;\n    formData.orderItems = orderItems;\n    purchasingService.createPurchaseOrder(formData).then(function (data) {\n      if (data.orderId) {\n        history.push(\"/purchasing/order/detail/\".concat(data.orderId));\n      }\n    }).catch(function (err) {\n      var _err$response;\n\n      toast.current.show({\n        severity: \"error\",\n        summary: t(\"common:errorMessage\"),\n        detail: (_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.data.errors,\n        life: 5000\n      });\n      return;\n    });\n  };\n\n  var calGrandTotal = function calGrandTotal(orderItems) {\n    if (orderItems.length === 0) return 0;\n    return orderItems.reduce(function (total, currentObj) {\n      return total + currentObj.amount;\n    }, 0);\n  };\n\n  var addOrderItem = function addOrderItem(productId, quantity) {\n    var i = orderItems.findIndex(function (_item) {\n      return _item.productId === productId;\n    });\n\n    if (i > -1) {\n      var newOrderItems = _toConsumableArray(orderItems);\n\n      var newQuantity = parseInt(newOrderItems[i].quantity) + quantity;\n      var unitAmount = newOrderItems[i].unitAmount;\n      if (newOrderItems[i].unitAmountEdit) unitAmount = newOrderItems[i].unitAmountEdit;\n      newOrderItems[i].quantity = newQuantity;\n      newOrderItems[i].amount = newQuantity * unitAmount;\n      setOrderItems(newOrderItems);\n      setGrandTotal(calGrandTotal(newOrderItems));\n    } else {\n      purchasingService.getProductDetail({\n        customerPartyId: defaultValues.customerOrg,\n        productId: productId,\n        vendorPartyId: supplierSelected\n      }).then(function (data) {\n        var newOrderItems = _toConsumableArray(orderItems);\n\n        var newItems = {\n          productId: productId,\n          quantity: quantity,\n          unitAmount: data.priceOut.price,\n          productName: data.product.productName,\n          priceUomId: data.priceOut.priceUomId,\n          unitAmountEdit: null,\n          amount: quantity * data.priceOut.price\n        };\n        newOrderItems.push(newItems);\n        setOrderItems(newOrderItems);\n        setGrandTotal(calGrandTotal(newOrderItems));\n      });\n    }\n  };\n\n  var removeOrderItem = function removeOrderItem(productId) {\n    console.log(productId);\n    var i = orderItems.findIndex(function (_item) {\n      return _item.productId === productId;\n    });\n\n    if (i > -1) {\n      var newOrderItems = _toConsumableArray(orderItems);\n\n      newOrderItems.splice(i, 1);\n      setOrderItems(newOrderItems);\n      setGrandTotal(calGrandTotal(newOrderItems));\n    }\n  };\n\n  var onChangeUnitAmountEdit = function onChangeUnitAmountEdit(props, value) {\n    var productObj = _toConsumableArray(props.value)[props.rowIndex];\n\n    productObj[props.field] = value;\n    var unitAmount = productObj.unitAmount;\n    if (productObj.unitAmountEdit) unitAmount = productObj.unitAmountEdit;\n    productObj.amount = productObj.quantity * unitAmount;\n    updateOrderItems(productObj);\n  };\n\n  var onChangeQuantity = function onChangeQuantity(props, value) {\n    var productObj = _toConsumableArray(props.value)[props.rowIndex];\n\n    if (value === 0) {\n      removeOrderItem(productObj.productId);\n    } else {\n      productObj[props.field] = value;\n      var unitAmount = productObj.unitAmount;\n      if (productObj.unitAmountEdit) unitAmount = productObj.unitAmountEdit;\n      productObj.amount = productObj.quantity * unitAmount;\n      updateOrderItems(productObj);\n    }\n  };\n\n  var updateOrderItems = function updateOrderItems(productObj) {\n    var productId = productObj.productId;\n    var i = orderItems.findIndex(function (_item) {\n      return _item.productId === productId;\n    });\n\n    if (i > -1) {\n      var newOrderItems = _toConsumableArray(orderItems);\n\n      newOrderItems[i] = productObj;\n      setOrderItems(newOrderItems);\n      setGrandTotal(calGrandTotal(newOrderItems));\n    }\n  };\n\n  var handleUpdateOrderItem = function handleUpdateOrderItem(orderItems) {\n    setOrderItems(orderItems);\n  };\n\n  var handleSetIsTableEditing = function handleSetIsTableEditing(bool) {\n    setIsTableEditing(bool);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-grid\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-col-12\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card p-fluid\",\n        children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n          children: t(\"common:order.createPurchasingOrder\")\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 11\n        }, _this), isSubmitting && /*#__PURE__*/_jsxDEV(ProgressBar, {\n          mode: \"indeterminate\",\n          style: {\n            height: \"6px\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(\"form\", {\n          className: \"p-mt-4\",\n          children: /*#__PURE__*/_jsxDEV(PurchasingCreateOrderHeaderForm, {\n            control: control,\n            errors: errors,\n            setSupplierSelected: setSupplierSelected\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-grid\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-col-12 p-md-6\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-col-12 p-md-9 p-pl-0\",\n              children: /*#__PURE__*/_jsxDEV(POSSearchProductForm, {\n                addOrderItem: addOrderItem\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 245,\n                columnNumber: 17\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 244,\n              columnNumber: 15\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 242,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(PurchasingCreateOrderProductList, {\n          onChangeUnitAmountEdit: onChangeUnitAmountEdit,\n          removeOrderItem: removeOrderItem,\n          onChangeQuantity: onChangeQuantity,\n          orderItems: orderItems,\n          grandTotal: grandTotal,\n          handleUpdateOrderItem: handleUpdateOrderItem,\n          handleSetIsTableEditing: handleSetIsTableEditing\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-grid\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-col-12 p-md-11\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 13\n          }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-col-12 p-md-1\",\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              disabled: isSubmitting || isTableEditing,\n              onClick: handleSubmit(onSubmit),\n              label: t(\"common:save\"),\n              icon: \"pi pi-check\",\n              type: \"submit\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 261,\n              columnNumber: 15\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 13\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 11\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 228,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(NewPurchasingOrders, \"SiZ4Wd3+Ys93uZy2jMidSfch4iM=\", false, function () {\n  return [useTranslation, useHistory, useForm];\n});\n\n_c = NewPurchasingOrders;\n\nvar _c;\n\n$RefreshReg$(_c, \"NewPurchasingOrders\");","map":{"version":3,"sources":["D:/eway/src/pages/NewPurchasingOrders.js"],"names":["React","useState","useContext","useEffect","useTranslation","useHistory","Button","ProgressBar","useForm","yupResolver","yup","PurchasingCreateOrderHeaderForm","PurchasingCreateOrderProductList","POSSearchProductForm","PurchasingService","ToastContext","NewPurchasingOrders","orderItems","setOrderItems","grandTotal","setGrandTotal","isTableEditing","setIsTableEditing","supplierSelected","setSupplierSelected","t","toast","history","purchasingService","document","title","schema","object","shape","supplier","string","required","originFacility","priority","number","positive","integer","min","max","shipAfterDate","date","Date","nullable","when","shipBeforeDate","ref","orderName","notRequired","defaultValues","customerOrg","resolver","control","formState","errors","isSubmitting","handleSubmit","onSubmit","data","length","current","show","severity","summary","detail","life","formData","vendorPartyId","customerPartyId","facilityId","getTime","createPurchaseOrder","then","orderId","push","catch","err","response","calGrandTotal","reduce","total","currentObj","amount","addOrderItem","productId","quantity","i","findIndex","_item","newOrderItems","newQuantity","parseInt","unitAmount","unitAmountEdit","getProductDetail","newItems","priceOut","price","productName","product","priceUomId","removeOrderItem","console","log","splice","onChangeUnitAmountEdit","props","value","productObj","rowIndex","field","updateOrderItems","onChangeQuantity","handleUpdateOrderItem","handleSetIsTableEditing","bool","height"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport { Button } from \"primereact/button\";\r\nimport { ProgressBar } from \"primereact/progressbar\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { yupResolver } from \"@hookform/resolvers/yup\";\r\nimport * as yup from \"yup\";\r\n\r\nimport { PurchasingCreateOrderHeaderForm } from \"../components/PurchasingCreateOrderHeaderForm\";\r\nimport { PurchasingCreateOrderProductList } from \"../components/PurchasingCreateOrderProductList\";\r\nimport { POSSearchProductForm } from \"../components/POSSearchProductForm\";\r\n\r\nimport { PurchasingService } from \"../service/PurchasingService\";\r\nimport { ToastContext } from \"../App\";\r\n\r\nexport const NewPurchasingOrders = () => {\r\n  const [orderItems, setOrderItems] = useState([]);\r\n  const [grandTotal, setGrandTotal] = useState(0);\r\n  const [isTableEditing, setIsTableEditing] = useState(false);\r\n  const [supplierSelected, setSupplierSelected] = useState(null);\r\n  const [t] = useTranslation();\r\n  const toast = useContext(ToastContext);\r\n  const history = useHistory();\r\n  const purchasingService = new PurchasingService();\r\n\r\n  useEffect(() => {\r\n    document.title = t(\"common:title.createNewPurchasingOrderList\");\r\n    return () => {\r\n      document.title = t('title.homepage');\r\n    }\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  const schema = yup.object().shape({\r\n    supplier: yup.string().required(t(\"common:valid.validFieldRequire\")),\r\n    originFacility: yup.string().required(t(\"common:valid.validFieldRequire\")),\r\n    priority: yup\r\n      .number()\r\n      .required(t(\"common:valid.validFieldRequire\"))\r\n      .positive()\r\n      .integer()\r\n      .min(1)\r\n      .max(9),\r\n    shipAfterDate: yup\r\n      .date()\r\n      .required(t(\"common:valid.validFieldRequire\"))\r\n      .min(\r\n        new Date(new Date() - 5 * 60 * 1000),\r\n        t(\"common:valid.validRequiredValueGreatherOrEqualDateTimeToDay\")\r\n      )\r\n      .nullable()\r\n      .when(\"shipBeforeDate\", (shipBeforeDate, schema) =>\r\n        shipBeforeDate\r\n          ? schema.max(\r\n              shipBeforeDate,\r\n              t(\"common:valid.validStartDateMustLessThanOrEqualFinishDate\")\r\n            )\r\n          : schema\r\n      ),\r\n    shipBeforeDate: yup\r\n      .date()\r\n      .required(t(\"common:valid.validFieldRequire\"))\r\n      .min(\r\n        yup.ref(\"shipAfterDate\") || new Date(),\r\n        yup.ref(\"shipAfterDate\")\r\n          ? t(\"common:valid.validFinishDateMustLargerThanStartDate\")\r\n          : t(\"common:valid.validRequiredValueGreatherOrEqualDateTimeToDay\")\r\n      )\r\n      .nullable(),\r\n    orderName: yup.string().notRequired(),\r\n  });\r\n\r\n  const defaultValues = {\r\n    supplier: \"\",\r\n    originFacility: \"\",\r\n    priority: 5,\r\n    shipAfterDate: null,\r\n    shipBeforeDate: null,\r\n    orderName: \"\",\r\n    customerOrg: \"ORG_ZIZI_CORP\",\r\n  };\r\n\r\n  const {\r\n    control,\r\n    formState: { errors, isSubmitting },\r\n    handleSubmit\r\n  } = useForm({ defaultValues, resolver: yupResolver(schema) });\r\n\r\n  const onSubmit = (data) => {\r\n    if (orderItems.length <= 0) {\r\n      toast.current.show({\r\n        severity: \"error\",\r\n        summary: t(\"common:errorMessage\"),\r\n        detail: t(\"common:order.listProductMustNotEmpty\"),\r\n        life: 5000,\r\n      });\r\n      return;\r\n    }\r\n\r\n    const formData = {};\r\n    formData.vendorPartyId = data.supplier;\r\n    formData.customerPartyId = data.customerOrg;\r\n    formData.facilityId = data.originFacility;\r\n    formData.shipAfterDate = data.shipAfterDate.getTime();\r\n    formData.shipBeforeDate = data.shipBeforeDate.getTime();\r\n    formData.orderName = data.orderName === \"\" ? null : data.orderName;\r\n    formData.priority = data.priority;\r\n    formData.orderItems = orderItems;\r\n\r\n    purchasingService\r\n      .createPurchaseOrder(formData)\r\n      .then((data) => {\r\n        if (data.orderId) {\r\n          history.push(`/purchasing/order/detail/${data.orderId}`);\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        toast.current.show({\r\n          severity: \"error\",\r\n          summary: t(\"common:errorMessage\"),\r\n          detail: err.response?.data.errors,\r\n          life: 5000,\r\n        });\r\n        return;\r\n      });\r\n  };\r\n\r\n  const calGrandTotal = (orderItems) => {\r\n    if (orderItems.length === 0) return 0;\r\n    return orderItems.reduce(\r\n      (total, currentObj) => total + currentObj.amount,\r\n      0\r\n    );\r\n  };\r\n\r\n  const addOrderItem = (productId, quantity) => {\r\n    let i = orderItems.findIndex((_item) => _item.productId === productId);\r\n    if (i > -1) {\r\n      let newOrderItems = [...orderItems];\r\n      let newQuantity = parseInt(newOrderItems[i].quantity) + quantity;\r\n      let unitAmount = newOrderItems[i].unitAmount;\r\n      if (newOrderItems[i].unitAmountEdit)\r\n        unitAmount = newOrderItems[i].unitAmountEdit;\r\n\r\n      newOrderItems[i].quantity = newQuantity;\r\n      newOrderItems[i].amount = newQuantity * unitAmount;\r\n      setOrderItems(newOrderItems);\r\n      setGrandTotal(calGrandTotal(newOrderItems));\r\n    } else {\r\n      purchasingService\r\n        .getProductDetail({\r\n          customerPartyId: defaultValues.customerOrg,\r\n          productId: productId,\r\n          vendorPartyId: supplierSelected,\r\n        })\r\n        .then((data) => {\r\n          let newOrderItems = [...orderItems];\r\n          let newItems = {\r\n            productId: productId,\r\n            quantity: quantity,\r\n            unitAmount: data.priceOut.price,\r\n            productName: data.product.productName,\r\n            priceUomId: data.priceOut.priceUomId,\r\n            unitAmountEdit: null,\r\n            amount: quantity * data.priceOut.price,\r\n          };\r\n\r\n          newOrderItems.push(newItems);\r\n          setOrderItems(newOrderItems);\r\n          setGrandTotal(calGrandTotal(newOrderItems));\r\n        });\r\n    }\r\n  };\r\n\r\n  const removeOrderItem = (productId) => {\r\n    console.log(productId);\r\n    let i = orderItems.findIndex((_item) => _item.productId === productId);\r\n    if (i > -1) {\r\n      let newOrderItems = [...orderItems];\r\n      newOrderItems.splice(i, 1);\r\n      setOrderItems(newOrderItems);\r\n      setGrandTotal(calGrandTotal(newOrderItems));\r\n    }\r\n  };\r\n\r\n  const onChangeUnitAmountEdit = (props, value) => {\r\n    let productObj = [...props.value][props.rowIndex];\r\n    productObj[props.field] = value;\r\n    let unitAmount = productObj.unitAmount;\r\n    if (productObj.unitAmountEdit) unitAmount = productObj.unitAmountEdit;\r\n    productObj.amount = productObj.quantity * unitAmount;\r\n    updateOrderItems(productObj);\r\n  };\r\n\r\n  const onChangeQuantity = (props, value) => {\r\n    let productObj = [...props.value][props.rowIndex];\r\n    if (value === 0) {\r\n      removeOrderItem(productObj.productId);\r\n    } else {\r\n      productObj[props.field] = value;\r\n      let unitAmount = productObj.unitAmount;\r\n      if (productObj.unitAmountEdit) unitAmount = productObj.unitAmountEdit;\r\n      productObj.amount = productObj.quantity * unitAmount;\r\n      updateOrderItems(productObj);\r\n    }\r\n  };\r\n\r\n  const updateOrderItems = (productObj) => {\r\n    const productId = productObj.productId;\r\n    let i = orderItems.findIndex((_item) => _item.productId === productId);\r\n    if (i > -1) {\r\n      let newOrderItems = [...orderItems];\r\n      newOrderItems[i] = productObj;\r\n      setOrderItems(newOrderItems);\r\n      setGrandTotal(calGrandTotal(newOrderItems));\r\n    }\r\n  };\r\n\r\n  const handleUpdateOrderItem = (orderItems) => {\r\n    setOrderItems(orderItems);\r\n  };\r\n\r\n  const handleSetIsTableEditing = (bool) => {\r\n    setIsTableEditing(bool);\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-grid\">\r\n      <div className=\"p-col-12\">\r\n        <div className=\"card p-fluid\">\r\n          <h5>{t(\"common:order.createPurchasingOrder\")}</h5>\r\n          {isSubmitting && (\r\n            <ProgressBar mode=\"indeterminate\" style={{ height: \"6px\" }} />\r\n          )}\r\n          <form className=\"p-mt-4\">\r\n            <PurchasingCreateOrderHeaderForm\r\n              control={control}\r\n              errors={errors}\r\n              setSupplierSelected={setSupplierSelected}\r\n            />\r\n          </form>\r\n          <div className=\"p-grid\">\r\n            <div className=\"p-col-12 p-md-6\">\r\n              <div className=\"p-col-12 p-md-9 p-pl-0\">\r\n                <POSSearchProductForm addOrderItem={addOrderItem} />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <PurchasingCreateOrderProductList\r\n            onChangeUnitAmountEdit={onChangeUnitAmountEdit}\r\n            removeOrderItem={removeOrderItem}\r\n            onChangeQuantity={onChangeQuantity}\r\n            orderItems={orderItems}\r\n            grandTotal={grandTotal}\r\n            handleUpdateOrderItem={handleUpdateOrderItem}\r\n            handleSetIsTableEditing={handleSetIsTableEditing}\r\n          />\r\n          <div className=\"p-grid\">\r\n            <div className=\"p-col-12 p-md-11\"></div>\r\n            <div className=\"p-col-12 p-md-1\">\r\n              <Button\r\n                disabled={isSubmitting || isTableEditing}\r\n                onClick={handleSubmit(onSubmit)}\r\n                label={t(\"common:save\")}\r\n                icon=\"pi pi-check\"\r\n                type=\"submit\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}