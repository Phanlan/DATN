{"ast":null,"code":"import _toConsumableArray from \"D:/eway/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _slicedToArray from \"D:/eway/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\n\nvar _jsxFileName = \"D:\\\\eway\\\\src\\\\components\\\\CreateOrderProductList.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext } from 'react';\nimport { DataTable } from 'primereact/datatable';\nimport { InputText } from 'primereact/inputtext';\nimport { Column } from 'primereact/column';\nimport { Button } from 'primereact/button';\nimport { POSSearchProductForm } from './POSSearchProductForm';\nimport { ProductService } from '../service/ProductService';\nimport { OrderService } from '../service/OrderService';\nimport { CommonService } from '../service/CommonService';\nimport { UserProfileContext } from '../App';\nimport { ToastContext } from \"../App\";\nimport { useTranslation } from 'react-i18next';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport var CreateOrderProductList = function CreateOrderProductList(props) {\n  _s();\n\n  var userProfile = useContext(UserProfileContext);\n  var toast = useContext(ToastContext);\n\n  var _useTranslation = useTranslation(),\n      _useTranslation2 = _slicedToArray(_useTranslation, 1),\n      t = _useTranslation2[0];\n\n  var id = props.id;\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      currentProductStore = _useState2[0],\n      setCurrentProductStore = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      orderItems = _useState4[0],\n      setOrderItems = _useState4[1];\n\n  var addNewOrderItem = function addNewOrderItem(productId, quantity) {\n    addOrderItem(productId, orderItems.length + 1, quantity);\n  };\n\n  var addOrderItem = function addOrderItem(productId, orderItemSeqId, quantity) {\n    var productService = new ProductService();\n    var i = orderItems.findIndex(function (_item) {\n      var flag = _item.productId === productId;\n\n      if (id) {\n        flag = flag && _item.orderItemSeqId === orderItemSeqId;\n      }\n\n      return flag;\n    });\n\n    if (i > -1) {\n      var newOrderItems = _toConsumableArray(orderItems);\n\n      newOrderItems[i].quantity = parseInt(newOrderItems[i].quantity) + quantity;\n      setOrderItems(newOrderItems);\n      props.setOrderItems(newOrderItems);\n      props.setGrandTotal(calTotal(newOrderItems));\n    } else {\n      var params = {\n        productStoreId: currentProductStore.productStoreId,\n        productId: productId\n      };\n      productService.getProductDetail(params).then(function (data) {\n        var newOrderItems = _toConsumableArray(orderItems);\n\n        var newItems = {\n          'productId': productId,\n          'quantity': quantity,\n          'unitAmount': data.priceOut.price,\n          'productName': data.product.productName,\n          'orderItemSeqId': orderItems.length + 1\n        };\n        newOrderItems.push(newItems);\n        setOrderItems(newOrderItems);\n        props.setOrderItems(newOrderItems);\n        props.setGrandTotal(calTotal(newOrderItems));\n        props.setGrandTotal(calTotal(newOrderItems));\n      });\n    }\n  };\n\n  var removeOrderItem = function removeOrderItem(productId, orderItemSeqId) {\n    var i = orderItems.findIndex(function (_item) {\n      var flag = _item.productId === productId;\n\n      if (id) {\n        flag = flag && _item.orderItemSeqId === orderItemSeqId;\n      }\n\n      return flag;\n    });\n\n    if (i > -1) {\n      var newOrderItems = _toConsumableArray(orderItems);\n\n      newOrderItems.splice(i, 1);\n      setOrderItems(newOrderItems);\n      props.setGrandTotal(calTotal(newOrderItems));\n      props.setOrderItems(newOrderItems);\n    }\n  };\n\n  var changeQuantity = function changeQuantity(productId, orderItemSeqId, quantity) {\n    var i = orderItems.findIndex(function (_item) {\n      var flag = _item.productId === productId;\n\n      if (id) {\n        flag = flag && _item.orderItemSeqId === orderItemSeqId;\n      }\n\n      return flag;\n    });\n\n    if (i > -1) {\n      var newOrderItems = _toConsumableArray(orderItems);\n\n      newOrderItems[i].quantity = quantity;\n      setOrderItems(newOrderItems);\n      props.setOrderItems(newOrderItems);\n      props.setGrandTotal(calTotal(newOrderItems));\n    }\n  };\n\n  var calTotal = function calTotal(items) {\n    var _total = 0.00;\n    items.forEach(function (_item) {\n      _total += _item.quantity * _item.unitAmount;\n    });\n    return _total.toFixed(2);\n  };\n\n  useEffect(function () {\n    var commonService = new CommonService();\n    commonService.getProductStores(userProfile.info.partyId).then(function (data) {\n      setCurrentProductStore(data.productStoreList[0]);\n    }).catch(function (err) {\n      toast.current.show({\n        severity: 'error',\n        summary: 'Error Message',\n        detail: err.response.data.errors,\n        life: 5000\n      });\n    });\n\n    if (id) {\n      var orderService = new OrderService();\n      var param = {\n        orderId: id\n      };\n      orderService.getOrderDetail(param).then(function (data) {\n        var items = data.orderDetail.orderItems;\n        items = items.map(function (elm, index) {\n          elm.productName = elm.itemDescription;\n          return elm;\n        });\n        setOrderItems(items);\n        props.setOrderItems(items);\n        props.setGrandTotal(data.orderDetail.grandTotal);\n      }).catch(function (err) {\n        toast.current.show({\n          severity: 'error',\n          summary: 'Error Message',\n          detail: err.response.data.errors,\n          life: 5000\n        });\n      });\n    }\n  }, [id, props, toast, userProfile.info.partyId]);\n\n  var colSeqBodyTemplate = function colSeqBodyTemplate(rowData) {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"p-column-title\",\n        children: rowData.header\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 17\n      }, _this), rowData.orderItemSeqId]\n    }, void 0, true);\n  };\n\n  var colIdBodyTemplate = function colIdBodyTemplate(rowData) {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"p-column-title\",\n        children: rowData.header\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 17\n      }, _this), rowData.productId]\n    }, void 0, true);\n  };\n\n  var colDescBodyTemplate = function colDescBodyTemplate(rowData) {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"p-column-title\",\n        children: rowData.header\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 17\n      }, _this), rowData.productName]\n    }, void 0, true);\n  };\n\n  var colQtyBodyTemplate = function colQtyBodyTemplate(rowData) {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"p-column-title\",\n        children: rowData.header\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 17\n      }, _this), /*#__PURE__*/_jsxDEV(InputText, {\n        id: \"quantity\",\n        name: \"quantity\",\n        type: \"text\",\n        value: rowData.quantity,\n        onChange: function onChange(e) {\n          return changeQuantity(rowData.productId, rowData.orderItemSeqId, e.target.value);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 17\n      }, _this)]\n    }, void 0, true);\n  };\n\n  var colTotalBodyTemplate = function colTotalBodyTemplate(rowData) {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"p-column-title\",\n        children: rowData.header\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 17\n      }, _this), rowData.unitAmount]\n    }, void 0, true);\n  };\n\n  var actionBodyTemplate = function actionBodyTemplate(rowData) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"actions\",\n      children: [/*#__PURE__*/_jsxDEV(Button, {\n        icon: \"pi pi-plus\",\n        className: \"p-button-rounded p-button-success p-mr-2\",\n        onClick: function onClick() {\n          return addOrderItem(rowData.productId, rowData.orderItemSeqId, 1);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 17\n      }, _this), /*#__PURE__*/_jsxDEV(Button, {\n        icon: \"pi pi-trash\",\n        className: \"p-button-rounded p-button-warning\",\n        onClick: function onClick() {\n          return removeOrderItem(rowData.productId, rowData.orderItemSeqId);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 17\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 13\n    }, _this);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-grid\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-col-12 p-mb-12 p-md-12\",\n        children: /*#__PURE__*/_jsxDEV(POSSearchProductForm, {\n          addOrderItem: addNewOrderItem\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 21\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 17\n      }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-col-12 p-mb-12 p-md-12\",\n        children: /*#__PURE__*/_jsxDEV(DataTable, {\n          value: orderItems,\n          dataKey: \"ProductId\",\n          className: \"datatable-responsive\",\n          children: [/*#__PURE__*/_jsxDEV(Column, {\n            field: \"orderItemSeqId\",\n            header: \"#\",\n            body: colSeqBodyTemplate\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 223,\n            columnNumber: 25\n          }, _this), /*#__PURE__*/_jsxDEV(Column, {\n            field: \"productId\",\n            header: t('common:product.id'),\n            body: colIdBodyTemplate\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 224,\n            columnNumber: 25\n          }, _this), /*#__PURE__*/_jsxDEV(Column, {\n            field: \"productName\",\n            header: t('common:product.name'),\n            body: colDescBodyTemplate\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 225,\n            columnNumber: 25\n          }, _this), /*#__PURE__*/_jsxDEV(Column, {\n            field: \"unitAmount\",\n            header: t('common:product.price'),\n            body: colTotalBodyTemplate\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 226,\n            columnNumber: 25\n          }, _this), /*#__PURE__*/_jsxDEV(Column, {\n            field: \"quantity\",\n            header: t('common:product.quantity'),\n            body: colQtyBodyTemplate\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 227,\n            columnNumber: 25\n          }, _this), /*#__PURE__*/_jsxDEV(Column, {\n            body: actionBodyTemplate\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 228,\n            columnNumber: 25\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 21\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 17\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 12\n    }, _this)\n  }, void 0, false);\n};\n\n_s(CreateOrderProductList, \"nlk7TP37SY6UWCmYYE6VNlVyJnY=\", false, function () {\n  return [useTranslation];\n});\n\n_c = CreateOrderProductList;\n\nvar _c;\n\n$RefreshReg$(_c, \"CreateOrderProductList\");","map":{"version":3,"sources":["D:/eway/src/components/CreateOrderProductList.js"],"names":["React","useState","useEffect","useContext","DataTable","InputText","Column","Button","POSSearchProductForm","ProductService","OrderService","CommonService","UserProfileContext","ToastContext","useTranslation","CreateOrderProductList","props","userProfile","toast","t","id","currentProductStore","setCurrentProductStore","orderItems","setOrderItems","addNewOrderItem","productId","quantity","addOrderItem","length","orderItemSeqId","productService","i","findIndex","_item","flag","newOrderItems","parseInt","setGrandTotal","calTotal","params","productStoreId","getProductDetail","then","data","newItems","priceOut","price","product","productName","push","removeOrderItem","splice","changeQuantity","items","_total","forEach","unitAmount","toFixed","commonService","getProductStores","info","partyId","productStoreList","catch","err","current","show","severity","summary","detail","response","errors","life","orderService","param","orderId","getOrderDetail","orderDetail","map","elm","index","itemDescription","grandTotal","colSeqBodyTemplate","rowData","header","colIdBodyTemplate","colDescBodyTemplate","colQtyBodyTemplate","e","target","value","colTotalBodyTemplate","actionBodyTemplate"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\r\n\r\nimport { DataTable } from 'primereact/datatable';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { Column } from 'primereact/column';\r\nimport { Button } from 'primereact/button';\r\n\r\nimport { POSSearchProductForm } from './POSSearchProductForm';\r\n\r\nimport { ProductService } from '../service/ProductService';\r\nimport { OrderService } from '../service/OrderService';\r\nimport { CommonService } from '../service/CommonService';\r\n\r\nimport {UserProfileContext} from '../App';\r\nimport { ToastContext } from \"../App\";\r\n\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nexport const CreateOrderProductList = (props) => {\r\n    const userProfile = useContext(UserProfileContext);\r\n    const toast = useContext(ToastContext);\r\n\r\n    const [t] = useTranslation();\r\n\r\n    const { id } = props;\r\n\r\n    const [currentProductStore, setCurrentProductStore] = useState(null);\r\n\r\n    const [orderItems, setOrderItems] = useState([]);\r\n\r\n    const addNewOrderItem = (productId, quantity) => {\r\n        addOrderItem(productId, orderItems.length + 1, quantity);\r\n    }\r\n\r\n    const addOrderItem = (productId, orderItemSeqId, quantity) => {\r\n        const productService = new ProductService();\r\n    \r\n        let i = orderItems.findIndex((_item) => {\r\n            let flag = _item.productId === productId;\r\n            if (id) {\r\n                flag = flag && _item.orderItemSeqId === orderItemSeqId;\r\n            }\r\n            return flag;\r\n        });\r\n        if (i > -1) {\r\n            let newOrderItems = [...orderItems];\r\n            newOrderItems[i].quantity = parseInt(newOrderItems[i].quantity) + quantity;\r\n            setOrderItems(newOrderItems);\r\n\r\n            props.setOrderItems(newOrderItems);\r\n            props.setGrandTotal(calTotal(newOrderItems));\r\n        } else {\r\n            let params = {\r\n                productStoreId: currentProductStore.productStoreId,\r\n                productId: productId\r\n            }\r\n            productService.getProductDetail(params).then(data => {\r\n                let newOrderItems = [...orderItems];\r\n                let newItems = {\r\n                    'productId': productId, \r\n                    'quantity': quantity,\r\n                    'unitAmount': data.priceOut.price,\r\n                    'productName': data.product.productName,\r\n                    'orderItemSeqId': orderItems.length + 1\r\n                }\r\n\r\n                newOrderItems.push(newItems)\r\n                setOrderItems(newOrderItems);\r\n\r\n                props.setOrderItems(newOrderItems);\r\n                props.setGrandTotal(calTotal(newOrderItems));\r\n                props.setGrandTotal(calTotal(newOrderItems));\r\n            });\r\n        }\r\n    }\r\n\r\n    const removeOrderItem = (productId, orderItemSeqId) => {\r\n        let i = orderItems.findIndex((_item) => {\r\n            let flag = _item.productId === productId;\r\n            if (id) {\r\n                flag = flag && _item.orderItemSeqId === orderItemSeqId;\r\n            }\r\n            return flag;\r\n        });\r\n        if (i > -1) {\r\n            let newOrderItems = [...orderItems];\r\n            newOrderItems.splice(i, 1);\r\n            setOrderItems(newOrderItems);\r\n\r\n            props.setGrandTotal(calTotal(newOrderItems));\r\n            props.setOrderItems(newOrderItems);\r\n        }\r\n    };\r\n\r\n    const changeQuantity = (productId, orderItemSeqId, quantity) => {\r\n        let i = orderItems.findIndex((_item) => {\r\n            let flag = _item.productId === productId;\r\n            if (id) {\r\n                flag = flag && _item.orderItemSeqId === orderItemSeqId;\r\n            }\r\n            return flag;\r\n        });\r\n        if (i > -1) {\r\n            let newOrderItems = [...orderItems];\r\n            newOrderItems[i].quantity = quantity;\r\n            setOrderItems(newOrderItems);\r\n\r\n            props.setOrderItems(newOrderItems);\r\n            props.setGrandTotal(calTotal(newOrderItems));\r\n        }\r\n    }\r\n\r\n    const calTotal = (items) => {\r\n        let _total = 0.00;\r\n        items.forEach(_item => {\r\n            _total += _item.quantity * _item.unitAmount;\r\n        });\r\n\r\n        return _total.toFixed(2);\r\n    }\r\n\r\n    useEffect(() => {\r\n        const commonService = new CommonService();\r\n        commonService.getProductStores(userProfile.info.partyId).then((data)=>{\r\n            setCurrentProductStore(data.productStoreList[0]);\r\n        })\r\n        .catch(err => {\r\n            toast.current.show({ severity: 'error', summary: 'Error Message', detail: err.response.data.errors, life: 5000 });\r\n        })\r\n\r\n        if (id) {\r\n            const orderService = new OrderService();\r\n            let param = {\r\n                orderId: id\r\n            }\r\n            orderService.getOrderDetail(param).then((data) => {\r\n                let items = data.orderDetail.orderItems;\r\n\r\n                items = items.map((elm, index) => {\r\n                    elm.productName = elm.itemDescription;\r\n\r\n                    return elm;\r\n                });\r\n\r\n                setOrderItems(items);\r\n                props.setOrderItems(items);\r\n                props.setGrandTotal(data.orderDetail.grandTotal);\r\n            })\r\n            .catch(err => {\r\n                toast.current.show({ severity: 'error', summary: 'Error Message', detail: err.response.data.errors, life: 5000 });\r\n            });\r\n        }\r\n    }, [id, props, toast, userProfile.info.partyId]);\r\n\r\n    const colSeqBodyTemplate = (rowData) => {\r\n        return (\r\n            <>\r\n                <span className=\"p-column-title\">{rowData.header}</span>\r\n                {rowData.orderItemSeqId}\r\n            </>\r\n        );\r\n    }\r\n\r\n    const colIdBodyTemplate = (rowData) => {\r\n        return (\r\n            <>\r\n                <span className=\"p-column-title\">{rowData.header}</span>\r\n                {rowData.productId}\r\n            </>\r\n        );\r\n    }\r\n\r\n    const colDescBodyTemplate = (rowData) => {\r\n        return (\r\n            <>\r\n                <span className=\"p-column-title\">{rowData.header}</span>\r\n                {rowData.productName}\r\n            </>\r\n        );\r\n    }\r\n\r\n    const colQtyBodyTemplate = (rowData) => {\r\n        return (\r\n            <>\r\n                <span className=\"p-column-title\">{rowData.header}</span>\r\n                <InputText\r\n                    id=\"quantity\"\r\n                    name=\"quantity\"\r\n                    type=\"text\"\r\n                    value={rowData.quantity}\r\n                    onChange={(e) => changeQuantity(rowData.productId, rowData.orderItemSeqId, e.target.value)}\r\n                />\r\n            </>\r\n        );\r\n    }\r\n\r\n    const colTotalBodyTemplate = (rowData) => {\r\n        return (\r\n            <>\r\n                <span className=\"p-column-title\">{rowData.header}</span>\r\n                {rowData.unitAmount}\r\n            </>\r\n        );\r\n    }\r\n\r\n    const actionBodyTemplate = (rowData) => {\r\n        return (\r\n            <div className=\"actions\">\r\n                <Button icon=\"pi pi-plus\" className=\"p-button-rounded p-button-success p-mr-2\" onClick={() => addOrderItem(rowData.productId, rowData.orderItemSeqId, 1)} />\r\n                <Button icon=\"pi pi-trash\" className=\"p-button-rounded p-button-warning\" onClick={() => removeOrderItem(rowData.productId, rowData.orderItemSeqId)} />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <>\r\n           <div className=\"p-grid\">\r\n                <div className=\"p-col-12 p-mb-12 p-md-12\">\r\n                    <POSSearchProductForm addOrderItem={addNewOrderItem}/>\r\n                </div>\r\n                <div className=\"p-col-12 p-mb-12 p-md-12\">\r\n                    <DataTable value={orderItems} dataKey=\"ProductId\"  className=\"datatable-responsive\">\r\n                        <Column field=\"orderItemSeqId\" header=\"#\" body={colSeqBodyTemplate}></Column>\r\n                        <Column field=\"productId\" header={t('common:product.id')} body={colIdBodyTemplate}></Column>\r\n                        <Column field=\"productName\" header={t('common:product.name')}  body={colDescBodyTemplate}></Column>\r\n                        <Column field=\"unitAmount\" header={t('common:product.price')} body={colTotalBodyTemplate}></Column>\r\n                        <Column field=\"quantity\" header={t('common:product.quantity')} body={colQtyBodyTemplate}></Column>\r\n                        <Column body={actionBodyTemplate}></Column>\r\n                    </DataTable>\r\n                </div>\r\n            </div>\r\n        </>\r\n    )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}